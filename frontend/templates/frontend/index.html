{% extends 'base.html' %}

{% block title %}Planner{% endblock %}

{% block content %}
<div id="month-header" class="text-center pt-5 pb-5 bg-success text-white border-bottom border-dark border-3">
  <h1 id="month-holder"></h1>
  <h1 id="year-holder"></h1>
  <div class="container d-flex justify-content-between">
    <button onclick="decrementMonth()" id="decrement" class="btn btn-light">&#60 </button>
    <button onclick="incrementMonth()" id="increment" class="btn btn-light">></button>
  </div>
</div>
<div class="bg-dark text-white overflow-hidden" style="height: 100%;">
  <div id="date-labels" class="container pt-3 pb-3">
    <div class="row">
      <h4 class="lab col">Su.</h4>
      <h4 class="lab col">Mo.</h4>
      <h4 class="lab col">Tu.</h4>
      <h4 class="lab col">We.</h4>
      <h4 class="lab col">Th.</h4>
      <h4 class="lab col">Fr.</h4>
      <h4 class="lab col">Sa.</h4>
    </div>
  </div>
  <div id="calendar" class="container" style="">
    <div class="row">
      <div id="sun" class="day-col col" style="align-self: end;">
        
      </div>
      <div id="mon" class="day-col col" style="align-self: end;">
        
      </div>
      <div id="tues" class="day-col col" style="align-self: end;">
        
      </div>
      <div id="wed" class="day-col col" style="align-self: end;">
        
      </div>
      <div id="thur" class="day-col col" style="align-self: end;">
        
      </div>
      <div id="fri" class="day-col col" style="align-self: end;">
        
      </div>
      <div id="sat" class="day-col col" style="align-self: end;">
        
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-center mt-2">
    <hr class="border text-center border-light border-2" style="width:50%;">
  </div>
  <div id="assignments-block">
    <div id="test" class="container">
      
    </div>
    <div id="assignment" class="container">
      
    </div>
    <div id="essay" class="container">
      
    </div>
    <div id="reading" class="container">
      
    </div>
  </div>
  <button class="btn btn-success position-fixed rounded-circle bottom-0 end-0">+</button>
</div>

<script type="text/javascript">
  const calendar = document.getElementById("calendar")
  const holder = document.getElementById("month-holder")
  const yearHolder = document.getElementById("year-holder")
  let d = new Date()
  const monthConversion = {
    "1": "January",
    "2": "February",
    "3": "March",
    "4": "April",
    "5": "May",
    "6": "June",
    "7": "July",
    "8": "August",
    "9": "September",
    "10": "October",
    "11": "November",
    "12": "December"
  }
  const days = ["sun", "mon", "tues", "wed", "thur", "fri", "sat"]

  function incrementMonth(){
    d = new Date(d).setMonth(new Date(d).getMonth() + 1)
    renderCalendar(new Date(d))
  }

  function decrementMonth(){
    d = new Date(d).setMonth(new Date(d).getMonth() - 1)
    renderCalendar(new Date(d))
  }
  
  function renderCalendar(date){
    console.log(date)
    const monthVal = date.getMonth() + 1
  
    holder.innerHTML = monthConversion[monthVal.toString()]
    yearHolder.innerHTML = date.getFullYear()

    // clear calendar (for change)
    const holders = document.getElementsByClassName("day-col")
    for(let i=0; i<holders.length; i++){
      holders[i].innerHTML = ""
    }
  
    // iterate through days
    for(let c= new Date(date.getFullYear(), date.getMonth(), 1); c<new Date(date.getFullYear(), date.getMonth() + 1, 1); c.setDate(c.getDate() + 1))
    {
      let day = new Date(c).getDay()
      if (new Date(c).getDate() != new Date().getDate() || new Date(c).getMonth() != new Date().getMonth() || new Date(c).getFullYear() != new Date().getFullYear()) {
        document.getElementById(days[day]).innerHTML += `
        <h4><button id="${new Date(c).getDate()}" onclick="getAssignments(${new Date(c).getFullYear()}, ${new Date(c).getMonth()+1}, ${new Date(c).getDate()})" class="date btn btn-dark">${new Date(c).getDate()}</button></h4>
        `
      }
      else {
        document.getElementById(days[day]).innerHTML += `
        <h4 id="red"><button class="date btn btn-danger" onclick="getAssignments(${new Date(c).getFullYear()}, ${new Date(c).getMonth()+1}, ${new Date(c).getDate()})">${new Date(c).getDate()}</button></h4>
        `
      }
    }
    const firstDay = new Date(date.getFullYear(), date.getMonth(), 1)
    const ld = new Date(date.getFullYear(), date.getMonth()+1,1)
    const lastDay = new Date(ld.setDate(ld.getDate() - 1))
    if (lastDay.getDay() != 6){
      let counter = lastDay.getDay() + 1
      while (counter <= 6){
        document.getElementById(days[counter]).innerHTML += `
        <h4 class="e-date invisible"><button>?</button></h4>
        `
        counter++
      }
    }
  }

  function getAssignments(year, month, day){
    const url = `https://planner.p3rplexed.repl.co/api/get-assignments/${year}/${month}/${day}/`
    console.log(url)
    const assignHolder = document.getElementById("assignment")
    const testHolder = document.getElementById("test")
    const essayHolder = document.getElementById("essay")
    const readingHolder = document.getElementById("reading")
    assignHolder.innerHTML = ""
    testHolder.innerHTML = ""
    essayHolder.innerHTML = ""
    readingHolder.innerHTML = ""
    const clickedBtn = document.getElementById(day)
    let isTest = false
    let isAssign = false
    let isEssay = false
    let isReading = false

    let blueBtns = document.getElementsByClassName("btn-primary")
    if(blueBtns.length > 0){
      blueBtns[0].className = "btn btn-dark"
    }
    clickedBtn.className = "btn btn-primary"
    
    fetch(url)
    .then((resp) => resp.json())
    .then(function(data){
      for(let i=0; i<data.length; i++){
        // console.log(data[i].title)
        if(data[i].type == "Test"){
          if(isTest == false){
            testHolder.innerHTML += `<h1>Tests/Quizzes</h1>`
            isTest = true
          }
          testHolder.innerHTML += `
          <div class="container border border-danger border-2 rounded text-light p-2">
            <h2>${data[i].title}</h2>
            <p>${data[i].description}</p>
          </div>
          `
        }
        else if (data[i].type == "Assignment"){
          if(isAssign == false){
            assignHolder.innerHTML += `<h1>General Assignments</h1>`
            isAssign = true
          }
          assignHolder.innerHTML += `
          <div class="container border border-primary border-2 rounded text-light p-2">
            <h2>${data[i].title}</h2>
            <p>${data[i].description}</p>
          </div>
          `
        }
        else if (data[i].type == "Reading"){
          if(isReading == false){
            readingHolder.innerHTML += `<h1>Reading</h1>`
            isReading = true
          }
          readingHolder.innerHTML += `
          <div class="container border border-warning border-2 rounded text-light p-2">
            <h2>${data[i].title}</h2>
            <p>${data[i].description}</p>
          </div>
          `
        }
        else {
          if(isEssay == false){
            essayHolder.innerHTML += `<h1>Essays/Writing</h1>`
            isEssay = true
          }
          essayHolder.innerHTML += `
          <div class="container border border-info border-2 rounded text-light p-2">
            <h2>${data[i].title}</h2>
            <p>${data[i].description}</p>
          </div>
          `
        }
      }
    })
  }
    
  window.onload = () => {
    // const d = new Date()
    renderCalendar(d)
  }
</script>
{% endblock %}